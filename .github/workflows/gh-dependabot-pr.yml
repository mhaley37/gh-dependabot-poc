name: Create PR for backstage.io

on:
  pull_request_target:
    types: [opened]
    branches: 
      - 'main'
    

jobs:
  rectify-backstage-packages:
    runs-on: ubuntu-latest
    if:  ${{ contains(github.event.pull_request.labels.*.name, 'backstage-bump') && (github.actor == 'dependabot[bot]' || github.actor == 'dependabot-preview[bot]' || github.actor == 'mhaley37')}}
    steps:       
      - uses: actions/checkout@v2
        with:
          ref: ${{github.head_ref}}
      - uses: actions/setup-node@v2
        with:   
          node-version: '16'
      - run: npx yarn install
      - name: bump backstage package versions
        run: npx backstage-cli versions:bump
      - name: update-pull-request
        uses: kt3k/update-pr-description@v1.1.0
        with:
          github_token: ${{secrets.GITHUB_TOKEN}}
          pr_title: Updated dependencies from backstage-cli versions:bump
      - name: Commit changes and push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add . && git commit -m "Updated dependencies from backstage-cli versions:bump" && git push